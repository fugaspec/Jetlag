<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Arrival — Flight Board</title>

<style>
/* === Responsive safeguards (added) === */
html, body {
  max-width: 100%;
  overflow-x: hidden;           /* 横はみ出し防止 */
}

.card, .board, .panel, .container, .app, #app {
  width: min(100%, 720px);      /* どの画面でもはみ出さない幅 */
  max-width: 100%;
  margin: 32px auto;
}

table {
  width: 100%;
  table-layout: fixed;          /* 各列が均等に縮む */
}
th, td {
  word-break: break-word;       /* 長い単語・アドレスも折返し */
  font-size: clamp(12px, 2.2vw, 16px); /* 画面幅で自動に縮小/拡大 */
}

/* スプリットフラップ風UIの横膨張を抑える */
.splitflap, .split-flap, .flap, .ticker {
  max-width: 100%;
  transform-origin: left center;
}

/* スマホ最適化 */
@media (max-width: 480px) {
  .card, .board, .panel, .container, .app, #app {
    width: 95%;
    margin: 20px auto;
  }
  th, td {
    font-size: 12px;
  }
  /* iOSの入力時ズームを抑止 */
  input[type="email"], input[type="text"] {
    font-size: 16px;
  }
}
/* === end responsive safeguards === */
</style>

<style>
  :root{
    --bg:#e6e6e6;          /* グレー背景 */
    --banner:#4f4f4f;      /* 濃いグレー帯 */
    --panel:#1e1f22;       /* フライトボード面 */
    --panel-edge:#101114;
    --grid:#2a2c30;        /* セル区切り */
    --text:#f1f1f1;
    --muted:#a0a0a0;
    --accent:#0bd46e;
    --warning:#ffd166;
    --danger:#ff5b5b;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    background:var(--bg);
    color:#111;
    font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Sans", "Noto Sans JP", sans-serif;
    display:flex; flex-direction:column;
  }
  /* Top banner (quote) */
  .banner{
    background:var(--banner);
    color:#fff;
    padding:12px 18px;
    font-size:14px;
    line-height:1.5;
    letter-spacing:.1px;
  }
  /* Layout */
  .wrap{
    width:min(92vw, 560px);
    margin:36px auto 48px;
    padding:0 16px;
  }
  /* Flight board container */
  .board{
    background: linear-gradient(180deg, var(--panel) 0%, #191a1d 100%);
    border: 1px solid #0b0c0f;
    border-radius: 14px;
    box-shadow: 0 14px 32px rgba(0,0,0,.20), inset 0 0 0 1px var(--panel-edge);
    padding:18px;
  }
  .board-head{
    display:flex; align-items:center; justify-content:space-between;
    color:var(--text);
    padding:6px 6px 10px;
    font-weight:600;
    letter-spacing:.3px;
  }
  .board-title{font-size:18px}
  .status-pill{
    font-size:12px; font-weight:700;
    color:#0a0; background:rgba(11,212,110,.14);
    border:1px solid rgba(11,212,110,.45);
    padding:6px 10px; border-radius:999px;
  }
  /* Grid header */
  .grid{
    display:grid;
    grid-template-columns: 120px 1fr 1fr 120px 130px;
    gap:0;
    border-top:1px solid #0f1114;
    border-bottom:1px solid #0f1114;
    width:100%;              /* ← 追加 */
    max-width:100%;          /* ← 追加 */
    overflow-x:hidden;       /* ← 追加 */
  }
  .cell{
    border-right:1px solid var(--grid);
    padding:10px 12px;
    color:var(--text);
    display:flex; align-items:center;
    min-height:48px;
  }
  .cell:last-child{border-right:0}
  .th{ font-size:12px; text-transform:uppercase; color:#c9cdd4; letter-spacing:.2px; }
  /* Split-flap letter strip */
  .flap{
    display:inline-grid; grid-auto-flow:column; gap:2px;
    background:#0f1114; border-radius:6px; padding:2px 4px;
    border:1px solid #0a0b0e;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.05);
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  }
  .flap .tile{
    position:relative; width:14px; height:22px;
    background:#1c1f23;
    border-radius:3px;
    border:1px solid #0d0f12;
    color:#f5f6f8;
    font-size:14px; line-height:22px; text-align:center;
    box-shadow: inset 0 -2px 0 rgba(0,0,0,.35);
    overflow:hidden;
  }
  .tile::before, .tile::after{
    content:""; position:absolute; left:0; right:0; height:1px; background:#0a0b0e;
  }
  .tile::before{ top:50%; opacity:.65 }
  .row{border-top:1px solid var(--grid)}
  /* Email submit row styled like a gate input */
  .email-row .cell{ align-items:stretch }
  .email-box{
    display:flex; gap:8px; width:100%;
  }
  .email-input{
    flex:1; min-width:0;
  }
  input[type="email"]{
    width:100%; height:100%;
    padding:12px 14px;
    background:#0f1114;
    border:1px solid #0a0b0e;
    color:#e9ecf1;
    border-radius:8px;
    outline:none;
    font-size:15px;
  }
  input::placeholder{ color:#7b808a }
  .btn{
    padding:12px 16px;
    background:#111316;
    color:#fff;
    border:1px solid #0a0b0e;
    border-radius:8px; cursor:pointer;
    font-weight:700; letter-spacing:.3px;
  }
  .btn:hover{ filter:brightness(1.05) }
  .btn:disabled{ opacity:.6; cursor:not-allowed }
  .hint{ color:var(--muted); font-size:12px; margin-top:10px }
  /* Toast */
  .toast{
    position:fixed; left:50%; bottom:26px; transform:translateX(-50%);
    background:#000; color:#fff; padding:10px 14px; border-radius:999px; font-size:14px;
    opacity:0; transition:.25s; pointer-events:none;
  }
  .toast.show{opacity:1}
  /* Small */
  @media (max-width: 720px){
    .grid{ grid-template-columns: 88px 1fr 1fr 96px 100px; }
    .cell{ min-height:44px; padding:8px 10px }
    .email-box{ flex-wrap: wrap; }
    .email-input{ width:100%; }
    .btn{ width:100%; margin-top:8px; }
  }
  @media (max-width: 480px){
    .wrap{ width:min(94vw, 420px); }
    .grid{ grid-template-columns: 74px 1fr 1fr 88px 88px; }
    .flap .tile{ width:11px; height:18px; font-size:12px; line-height:18px; }
    .board-head{ flex-wrap:wrap; gap:8px; }
  }
</style>
</head>
<body>
  <div class="banner">
    The soul cannot travel quickly and is left behind, having to wait until the body arrives, much like lost baggage.
  </div>

  <div class="wrap">
    <div class="board" role="region" aria-label="Flight-style board">
      <div class="board-head">
        <div class="board-title">The Perfect Jet Lag</div>
        <div class="status-pill" id="clock">JST --:--</div>
      </div>

      <div class="grid" role="table" aria-label="Flight schedule style">
        <div class="cell th" role="columnheader">FLIGHT</div>
        <div class="cell th" role="columnheader">FROM</div>
        <div class="cell th" role="columnheader">TO</div>
        <div class="cell th" role="columnheader">ARRIVAL</div>
        <div class="cell th" role="columnheader">STATUS</div>

        <!-- Decorative sample row -->
        <div class="cell" role="cell"><div class="flap" data-text="-"></div></div>
        <div class="cell" role="cell"><div class="flap" data-text="Tokyo"></div></div>
        <div class="cell" role="cell"><div class="flap" data-text="-"></div></div>

        <!-- Email submission row, like a gate interaction -->
        <div class="cell th" role="columnheader">TICKET</div>
        <div class="cell email-row" role="cell" colspan="4" style="grid-column: span 4;">
          <div class="email-box" style="width:100%">
            <div class="email-input">
              <label for="email" class="sr-only" style="position:absolute;left:-9999px">e-mail</label>
              <input id="email" type="email" placeholder="e-mail" autocomplete="email" required aria-label="e-mail">
            </div>
            <button id="submitBtn" class="btn">submit</button>
          </div>
        </div>
      </div>

      <div class="hint">Cooperated with Genelec Japan</div>
    </div>
  </div>

  <div class="toast" id="toast">送信しました。</div>

<script>
  // --- Clock (JST) ---
  const clockEl = document.getElementById('clock');
  const fmt = (n)=> n.toString().padStart(2,'0');
  function tickClock(){
    const jst = new Date().toLocaleTimeString("ja-JP", { timeZone: "Asia/Tokyo", hour: "2-digit", minute: "2-digit" });
    clockEl.textContent = `JST ${jst}`;
  }
  setInterval(tickClock, 1000); tickClock();

  // --- Split-flap generator ---
  const CHARS = " 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ:-";
  function buildFlap(el){
    const text = (el.getAttribute('data-text')||"").toUpperCase();
    el.innerHTML = "";
    [...text].forEach(ch => {
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.dataset.target = CHARS.includes(ch) ? ch : ' ';
      tile.textContent = ' ';
      el.appendChild(tile);
    });
  }
  function flapTo(el, newText, delay=40){
    const tiles = el.querySelectorAll('.tile');
    const chars = (newText.toUpperCase()).padEnd(tiles.length,' ').split('');
    tiles.forEach((tile, idx) => {
      const target = CHARS.indexOf(chars[idx]||' ');
      let cur = CHARS.indexOf(tile.textContent);
      if(cur < 0) cur = 0;
      const steps = (target - cur + CHARS.length) % CHARS.length;
      for(let s=1; s<=steps; s++){
        setTimeout(()=>{
          const next = CHARS[(cur + s) % CHARS.length];
          tile.textContent = next;
        }, delay * (idx + s));
      }
      tile.dataset.target = chars[idx];
    });
  }
  // Initialize all flaps
  document.querySelectorAll('.flap').forEach(buildFlap);
  // Animate the header row a little on load
  setTimeout(()=>{
    document.querySelectorAll('.flap').forEach(el=>flapTo(el, el.getAttribute('data-text')));
  }, 200);

  // --- Submit handling ---
  const email = document.getElementById('email');
  const btn = document.getElementById('submitBtn');
  const toast = document.getElementById('toast');

  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 2000);
  }

  async function submitEmail(){
    const v = email.value.trim();
    if(!v) { showToast('e-mail を入力してください'); email.focus(); return; }
    if(!/^\S+@\S+\.\S+$/.test(v)){ showToast('e-mail の形式を確認してください'); email.focus(); return; }
    btn.disabled = true;
    try{
      const res = await fetch('/api/submit', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: v })
      });
      const j = await res.json().catch(()=> ({}));
      if(!res.ok) throw new Error(j?.error || '送信に失敗しました');
      showToast('送信しました');
      email.value='';
    }catch(err){
      showToast(err?.message || 'エラーが発生しました');
    }finally{
      btn.disabled = false;
    }
  }
  btn.addEventListener('click', submitEmail);
  email.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){ e.preventDefault(); submitEmail(); }
  });
</script>
</body>
</html>
